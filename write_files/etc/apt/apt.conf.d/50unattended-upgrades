// Unattended Upgrades Configuration for Headscale VPS
// SECURITY ONLY: Restricted to security updates to prevent breaking changes

Unattended-Upgrade::Allowed-Origins {
    "${distro_id}:${distro_codename}-security";
    "${distro_id}ESMApps:${distro_codename}-apps-security";
    "${distro_id}ESM:${distro_codename}-infra-security";
};

// Remove unused kernel packages
Unattended-Upgrade::Remove-Unused-Kernel-Packages "true";

// Remove unused dependencies
Unattended-Upgrade::Remove-Unused-Dependencies "true";

// Automatic reboot if required (Headscale reconnects gracefully)
Unattended-Upgrade::Automatic-Reboot "true";
Unattended-Upgrade::Automatic-Reboot-Time "03:00";

// Email notification (uses msmtp)
Unattended-Upgrade::Mail "root";
Unattended-Upgrade::MailReport "always";

// Syslog logging
Unattended-Upgrade::SyslogEnable "true";
Unattended-Upgrade::SyslogFacility "daemon";

// Run Headscale/Headplane update after OS packages
Unattended-Upgrade::Post-Invoke {
    "/usr/local/bin/headscale-update --unattended || true";
};